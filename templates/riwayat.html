<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>E-Perpus</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- Style CSS -->
    <link href="{{ url_for('static', filename='user/style.css') }}" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <!-- Bulma CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
    <!-- Feather Icon -->
    <script src="https://unpkg.com/feather-icons"></script>
    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
        integrity="sha384-l2VRKbYi1aGRZ5oxk/xDeQPQq5Ffmvj8ZkKW1D5FA7kFeM4M6F7L/lUn2P5xkiM+T" crossorigin="anonymous">
    <script>
        $(document).ready(function () {
            show_riwayat();
        });

        function show_riwayat() {
            $('#cards-box').empty();
            $.ajax({
                type: "GET",
                url: "/riwayat",
                data: {},
                success: function (response) {
                    let rows_book = response['books'];
                    let rows_peminjaman = response['peminjaman'];
                    for (let i = 0; i < rows_peminjaman.length; i++) {
                        for (let j = 0; j < rows_book.length; j++) {
                            if (rows_peminjaman[i]['book_id'] === rows_book[j]['_id']) {
                                let id = rows_peminjaman[i]['_id'];
                                let title = rows_book[j]['title'];
                                let tgl_pinjam = rows_peminjaman[i]['tgl_pinjam'];
                                let status = rows_peminjaman[i]['status'];
                                let temp_html = '';
                                if (status === 0) {
                                    let temp_html = `<div class="card mb-3 mx-auto pointer-cursor" style="max-width: 900px;" data-bs-toggle="modal"
                        data-bs-target="">
                        <div class="row g-0">
                            <div class="col-8 col-md-9 col-lg-10">
                                <div class="card-body">
                                    <h5 class="card-title">${title}</h5>
                                    <p class="card-text fw-bold">Tanggal Pinjam : <small class="text-muted">${tgl_pinjam}</small>
                                    </p>
                                </div>
                            </div>
                            <div class="col-4 col-md-3 col-lg-2 d-flex align-items-center">
                                <div class="card-body">
                                    <button type="button" onclick="showInfo('${id}')"
                                        class="btn btn-outline-warning btnriwayat shadow-sm">Pending</button>
                                </div>
                                </div>
                                </div>
                                </div>`;
                                } else {
                                    temp_html = `<div class="card mb-3 mx-auto pointer-cursor" style="max-width: 900px;" data-bs-toggle="modal"
                        data-bs-target="">
                        <div class="row g-0">
                            <div class="col-8 col-md-9 col-lg-10">
                                <div class="card-body">
                                    <h5 class="card-title">${title}</h5>
                                    <p class="card-text fw-bold">Tanggal Pinjam : <small class="text-muted">${tgl_pinjam}</small>
                                    </p>
                                </div>
                            </div>
                            <div class="col-4 col-md-3 col-lg-2 d-flex align-items-center">
                                <div class="card-body">
                                    <button type="button" onclick="showInfo('${id}')"
                                        class="btn btn-outline-success btnriwayat shadow-sm">Accepted</button>
                                </div>
                                </div>
                                </div>
                                </div>`;
                                }

                                $('#cards-box').append(temp_html);
                            }
                        }
                    }
                }
            });
        }

        function showInfo(bookId) {
            $.ajax({
                type: "GET",
                url: `/info/${bookId}`,
                data: {},
                success: function (response) {
                    let book = response['book'];
                    let peminjaman = response['peminjaman'];

                    // Update modal deskripsi dengan informasi dari response
                    $('#deskripsi .card-img-top').attr('src', '/static/images/' + book['image']);
                    $('#deskripsi .card-title').text(book['title']);
                    $('#deskripsi .card-text-genre').text(`Genre: ${book['genre']}`);
                    $('#deskripsi .card-text-tahun').text(`Tahun: ${book['tahun']}`);
                    $('#deskripsi .card-text-penulis').text(`Penulis: ${book['penulis']}`);
                    $('#deskripsi .card-text-nama').val(`Nama: ${peminjaman['nama']}`);
                    $('#deskripsi .card-text-alamat').val(`Alamat: ${peminjaman['alamat']}`);
                    $('#deskripsi .card-text-telp').val(`No. Telepon: ${peminjaman['telp']}`);
                    $('#deskripsi .card-text-tgl-pinjam').val(`Tanggal Pinjam: ${peminjaman['tgl_pinjam']}`);
                    $('#deskripsi .card-text-tgl-kembali').val(`Tanggal Kembali: ${peminjaman['tgl_kembali']}`);
                    $('#deskripsi .card-text-catatan').val(`Catatan: ${peminjaman['catatan']}`);

                    // Ganti kondisi untuk menetapkan status
                    if (peminjaman['status'] === 0) {
                        $('#deskripsi .card-text-status').val(`Status: Pending`);
                        $('#deskripsi .card').addClass('bg-warning');
                        $('#deskripsi .card-text-status').addClass('text-warning');
                    } else {
                        $('#deskripsi .card-text-status').val(`Status: Accepted`);
                        $('#deskripsi .card').addClass('bg-success');
                        $('#deskripsi .card-text-status').addClass('text-success');
                    }

                    // Tampilkan modal deskripsi
                    $('#deskripsi').addClass('is-active');
                }
            });
        }

    </script>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-light navbar shadow-sm sticky-top">
        <div class="container">
            <a class="navbar-brand text-primary" href="/">E-Perpus</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link text-dark" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-dark" href="/buku">Buku</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-dark" href="/about">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-dark" href="/contact_us">Contact Us</a>
                    </li>
                    <div class="dropdown">
                        <button class="btn btn-primary dropdown-toggle" style="border-radius: 20px;" type="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            <img class="rounded-circle" style="width: 30px; height: 30px;"
                                src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSteItzPyeDKBxyWiOA8xrPZXIlxOYv1b1VVg&usqp=CAU" />
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/profil">Pengaturan Profil</a></li>
                            <li><a class="dropdown-item" href="/hal_riwayat">Riwayat Peminjaman</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="#">Sign Out</a></li>
                        </ul>
                    </div>
                </ul>
            </div>
        </div>
    </nav>
    <section class="artikel_area section_gap py-5" id="artikelsection" style="min-height:100vh">
        <div class="container">
            <div class="mb-5">
                <h3 class="text-center fw-bold judulkategori">Riwayat Peminjaman</h3>

                <hr class="mx-auto">
            </div>
            <div class="wrapper-riwayat" id="cards-box">
                <!-- <div class="card mb-3 mx-auto pointer-cursor" style="max-width: 900px;" data-bs-toggle="modal"
                    data-bs-target="">
                    <div class="row g-0">
                        <div class="col-8 col-md-9 col-lg-10">
                            <div class="card-body">
                                <h5 class="card-title">Amelia</h5>
                                <p class="card-text fw-bold">Éclair : Pagi Terakhir di Rusia</p>
                                <p class="card-text fw-bold"><small class="text-muted">DD/MM/YY</small>
                                </p>
                            </div>
                        </div>
                        <div class="col-4 col-md-3 col-lg-2 d-flex align-items-center">
                            <div class="card-body">
                                <a onclick="$('#deskripsi').addClass('is-active')"
                                    class="btn btn-outline-warning btnriwayat shadow-sm">Read
                                    More</a>
                            </div> -->

                            <div class="modal" id="deskripsi">
                                <div class="modal-background" onclick="$('#deskripsi').removeClass('is-active')"></div>
                                <div class="modal-content">
                                    <div class="box">
                                        <article class="media">
                                            <div class="media-content">
                                                <div class="field">
                                                    <div class="row row-cols-1 row-cols-md-3 g-4" id="cards-box">
                                                        <div class="col-md-4">
                                                            <div class="card shadow h-100">
                                                                <img src="https://books.google.co.id/books/content?id=FbI24xANEx0C&hl=id&pg=PP1&img=1&zoom=3&sig=ACfU3U1eiDcK4JPhiiv5u9_W0Gp7qd5N0A&w=1280"
                                                                    class="card-img-top" style="height: 100%;">
                                                                <div class="card-body">
                                                                    <h5 class="card-title mb-2">Éclair : Pagi Terakhir
                                                                        di Rusia</h5>
                                                                    <p class="card-text">Genre : Romance</p>
                                                                    <p>Penulis : Prisca Primasari</p>
                                                                    <p>Tahun : 2011</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-8">
                                                            <h4>Detail Peminjaman</h4>
                                                            <form>
                                                                <div class="mb-3">
                                                                    <input type="text" class="form-control" id="nama"
                                                                        placeholder="Nama Lengkap"
                                                                        style="border: 2px solid grey;"
                                                                        value="Nama Lengkap" disabled>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <input type="text" class="form-control" id="alamat"
                                                                        placeholder="Alamat"
                                                                        style="border: 2px solid grey;" value="Alamat"
                                                                        disabled>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <input type="text" class="form-control" id="telp"
                                                                        placeholder="No. Telepon"
                                                                        style="border: 2px solid grey;"
                                                                        value="No. Telepon" disabled>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <label for="exampleInputEmail1"
                                                                        class="form-label">Tanggal Pinjam</label>
                                                                    <input type="date" class="form-control"
                                                                        id="tgl_pinjam" placeholder="Tanggal Pinjam"
                                                                        style="border: 2px solid grey;" value="Pending"
                                                                        disabled>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <label for="exampleInputEmail1"
                                                                        class="form-label">Tanggal Kembali</label>
                                                                    <input type="date" class="form-control"
                                                                        id="tgl_kembali" placeholder="Tanggal Kembali"
                                                                        style="border: 2px solid grey;" value="Pending"
                                                                        disabled>
                                                                </div>
                                                                <div class="form-floating">
                                                                    <label for="exampleInputEmail1"
                                                                        class="form-label">Catatan</label>
                                                                    <textarea class="form-control" placeholder="Catatan"
                                                                        id="floatingTextarea2"
                                                                        style="height: 100px; border: 2px solid grey;"
                                                                        value="Pending" disabled></textarea>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <label for="status" class="form-label">Status</label>
                                                                    <input type="text" class="form-control" id="status" readonly>
                                                                </div>
                                                                <hr class="mx-auto">
                                                                <button type="button" class="btn btn-outline-danger"
                                                                    onclick="$('#deskripsi').removeClass('is-active')">CLOSE</button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </article>
                                    </div>
                                </div>
                            </div>
                        <!-- </div>
                    </div>
                </div> -->
            </div>
        </div>
    </section>



    <footer class="copyright mt-0">
        <div class="container py-2">
            <p class="text-left my-3">Copyright © by Kelompok 3 </p>
            <!-- <a href="https://www.instagram.com/akun-instagram-anda" target="_blank" class="social-icon"><i
                    class="fab fa-instagram"></i></a>
            <a href="https://www.facebook.com/akun-facebook-anda" target="_blank" class="social-icon"><i
                    class="fab fa-facebook"></i></a>
            <a href="https://www.situs-anda.com" target="_blank" class="social-icon"><i class="fas fa-globe"></i></a> -->
        </div>
    </footer>




    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
</body>

</html>